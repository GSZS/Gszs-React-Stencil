#### React生产环境部署

#### 🌱 安装所需依赖

* <b>安装yum必要依赖模块</b>

  yum -y install gcc gcc-c++ autoconf pcre-devel make automake

  yum -y install wget httpd-tools vim

  sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm

* <b>安装Nginx</b>

    sudo yum install -y nginx

#### 🌵 Nginx

  ```js
  // 启动Nginx 
  nginx

  // ❗️如果启动nginx报80端口被占用的话:解决方法如下
  netstat -anp|grep 80
  kill -9 (占用80端口的id)

  // 设置开机启动nginx
  sudo systemctl enable nginx.service
    
  ```

#### 🍀 简易部署

  ```js
  // 打包React项目
  yarn build
  
  // 将打包的文件上传至服务器中的"/usr/share/nginx/html"
  
  // 在服务器nginx目录下新建一个私人的nginx.conf，并写入如下内容:
  mkdir conf.d && vim default.conf
  
  // 写入的内容
  server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;
    #access_log  /var/log/nginx/host.access.log  main;

    location / {
      root /usr/share/nginx/html/build;
	    index  index.html index.htm;
    }
  }

  // 在原nginx.conf中导入私人的nginx-server配置
  
  http {
    ...
    +++ include /etc/nginx/conf.d/*.conf; // 加上这行用于导入私人nginx-server配置
    ...
  }

  // 重启nginx
  nginx -s reload

  // 测试(nginx默认是80端口)
  ip/#/login

  ```

#### 🌿 阿里云

  ```js
  // 绑定域名
  直接在域名解析那里添加一条A的解析记录，将IP与域名绑定
  ```

  ```js
  /*  将HTTP升级为HTTPS */

  // 先开启阿里云服务器的443端口
  // 配置Nginx.conf,我的配置如下(两个server分别对应HTTP跟HTTPS)
  # HTTPS:
  server {
    listen       443 ssl; # 要在阿里云服务器开启443端口
    server_name  www.gszs.top; # 绑定ssl证书的域名
    ssl on;
    ssl_certificate /usr/share/nginx/ssl/gszs_nginx.top.pem; # pem路径
    ssl_certificate_key /usr/share/nginx/ssl/gszs_nginx.top.key; # key路径
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;

  location / {
      # root /usr/share/nginx/html;
      root /usr/share/nginx/html/build;
      index index.html index.htm;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
      root /usr/share/nginx/html;
    }

  }

  # HTTP:
  server {
    listen  80;
    server_name localhost;

    location / {
      root /usr/share/nginx/html/build;
      index index.html index.htm;
    }

    error_page 500 502 503 504 /50x.html;

    location = /50x.html {
      root /usr/share/nginx/html;
    }
  }

  ```